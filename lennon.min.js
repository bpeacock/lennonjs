/*!
 * Lennon v0.1
 *
 * An extremely lightweight router that uses the History API and falls back to hash.
 *
 * @author Gabe Hayes <gabriel.hayes@gmail.com>
 * @copyright 2013, Gabe Hayes
 */

(function(e,t,n,r){return e.Lennon=function(r){var i=!1,s=t.extend({historyEnabled:n.history,linkSelector:"a[target!=_blank]:not([href^=http])",logger:e.console,publishEvent:null},r),o=[],u=function(n){var r=t(s.linkSelector),o=function(){n.process()};s.historyEnabled?r.each(function(){var n=t(this);n.data("lennonized")||n.on("click",function(){return e.history.pushState(null,null,t(this).attr("href")),o(),!1}).data("lennonized",!0)}):r.each(function(){var e=t(this),n=e.attr("href");e.data("lennonized")||e.attr("href","/#"+n).data("lennonized",!0)}),i||(t(e).on(s.historyEnabled?"popstate":"hashchange",o),i=!0)};return function(){return{define:function(e,t){var n=e.match(/:/g)||[],r=new RegExp("^"+e.replace(/\//g,"\\/").replace(/:(\w*)/g,"(\\w*)")+"$"),i={eventName:t,paramCount:n.length,path:e,pattern:r};if("string"==typeof t&&!s.publishEvent)throw new Error('Cannot publish the event "'+t+'" for the route "'+e+'". No publishEvent has been provided.');s.logger.info("Adding route",e,i),o.push(i),u(this)},dispatch:function(e,t){var n;return s.logger.info("Dispatching",e.path,"with",t),"function"==typeof e.eventName?n=e.eventName(t||{}):n=s.publishEvent(e.eventName,t||{}),n},process:function(){var t={},n,r,i,u,a=s.historyEnabled?e.location.pathname:e.location.hash.replace("#","")||"/";e.location.hash&&s.historyEnabled&&(e.location.href=e.location.hash.replace("#","")),s.logger.info("Processing path",a);for(n in o){u=a.match(o[n].pattern);if(u){i=o[n].path.match(/:(\w*)/g,"(\\w*)");for(r=1;r<=o[n].paramCount;r++)t[i[r-1].replace(/:/g,"")]=u[r];return this.dispatch(o[n],t)}}s.logger.warn("No route dispatched")}}}()}})(this,jQuery,Modernizr),typeof define=="function"&&define("Lennon",[],function(){return Lennon}),define("lennon",function(){});