/*!
 * Lennon v0.1
 *
 * An extremely lightweight router that uses the History API and falls back to hash.
 *
 * @author Gabe Hayes <gabriel.hayes@gmail.com>
 * @copyright 2013, Gabe Hayes
 */
(function(a,b,c){"use strict";return a.Lennon=function(d){var e=!1,f=b.extend({historyEnabled:c.history,linkSelector:"a[target!=_blank]:not([href^=http])",logger:a.console,publishEvent:null},d),g=[],h=function(c){var d=b(f.linkSelector),g=function(){c.process()};f.historyEnabled?d.each(function(){var c=b(this);c.data("lennonized")||c.on("click",function(){return a.history.pushState(null,null,b(this).attr("href")),g(),!1}).data("lennonized",!0)}):d.each(function(){var a=b(this),c=a.attr("href");a.data("lennonized")||a.attr("href","/#"+c).data("lennonized",!0)}),e||(b(a).on(f.historyEnabled?"popstate":"hashchange",g),e=!0)};return function(){return{define:function(a,b){var c=a.match(/:/g)||[],d=RegExp("^"+a.replace(/\//g,"\\/").replace(/:(\w*)/g,"(\\w*)")+"$"),e={eventName:b,paramCount:c.length,path:a,pattern:d};if("string"==typeof b&&!f.publishEvent)throw Error('Cannot publish the event "'+b+'" for the route "'+a+'". No publishEvent has been provided.');f.logger.info("Adding route",a,e),g.push(e),h(this)},dispatch:function(a,b){var c;return f.logger.info("Dispatching",a.path,"with",b),c="function"==typeof a.eventName?a.eventName(b||{}):f.publishEvent(a.eventName,b||{})},process:function(){var c,d,e,h,b={},i=f.historyEnabled?a.location.pathname:a.location.hash.replace("#","")||"/";a.location.hash&&f.historyEnabled&&(a.location.href=a.location.hash.replace("#","")),f.logger.info("Processing path",i);for(c in g)if(h=i.match(g[c].pattern)){for(e=g[c].path.match(/:(\w*)/g,"(\\w*)"),d=1;g[c].paramCount>=d;d++)b[e[d-1].replace(/:/g,"")]=h[d];return this.dispatch(g[c],b)}f.logger.warn("No route dispatched")}}}()}})(this,jQuery,Modernizr),"function"==typeof define&&define("Lennon",[],function(){return Lennon});